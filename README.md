# Дипломный проект DLS первого семестра: перенос стиля изображений

Этот проект предоставляет веб-сервис для применения методов переноса стиля на изображения с использованием двух моделей: CycleGAN и Stable Diffusion. Сервис построен с использованием **FastAPI** для бэкенда и **Streamlit** для фронтенда. Пользователи могут загрузить изображение и применить к нему стиль с помощью выбранной модели, регулируя степень воздействия стиля.
Возможность выбирать степень воздействия стиля и современную дифузионную модель Stable Diffusion для инференса является дополнительным функционламю.
## Описание файлов

### 1. **`server.py`** (Бэкенд - FastAPI)
Этот файл содержит бэкенд API, построенный с использованием FastAPI, который выполняет перенос стиля. Он предоставляет один эндпоинт `/generate`, который принимает POST-запросы с изображением контента и выбранной моделью для переноса стиля. В файле выполняются следующие действия:
- Принимает изображения и параметры (выбор модели и сила стиля).
- Обрабатывает изображение с помощью **CycleGAN** или **Stable Diffusion** в зависимости от выбора пользователя.
- Возвращает стилизованное изображение в формате PNG.

#### Основные функции:
- `generate_image`: Обрабатывает запросы и выполняет перенос стиля.
- Используются классы `Cycle_gan` и `StableDiffusionPipeline` для загрузки и применения соответствующих моделей.

### 2. **`app.py`** (Фронтенд - Streamlit)
Этот файл создаёт веб-интерфейс с помощью **Streamlit**, в котором пользователи могут взаимодействовать с API. В приложении можно загрузить изображение контента, выбрать модель переноса стиля и настроить силу стиля. После отправки запроса в бэкенд приложение отображает как оригинальное, так и стилизованное изображение.

#### Основные функции:
- Загрузка изображения контента.
- Выбор модели (**CycleGAN** или **Stable Diffusion**).
- Слайдер для настройки силы стиля.
- Отображение результата и оригинала изображения.

### 3. **`cycle_gan.py`** (Модель CycleGAN)
Этот файл содержит класс **CycleGAN**, который выполняет перенос стиля с использованием предобученной модели CycleGAN. Модель загружается из файла (`cycle_gan.pth`), и класс предоставляет метод для применения стиля к изображению.

#### Основные функции:
- `load_model`: Загружает предобученную модель CycleGAN.
- `transfer_style`: Применяет перенос стиля к загруженному изображению с помощью модели CycleGAN.

### Зависимости
- **FastAPI**: Для построения бэкенд API.
- **Streamlit**: Для создания фронтенда.
- **Pillow (PIL)**: Для обработки изображений.
- **Torch**: Для модели CycleGAN и преобразования изображений.
- **diffusers**: Для модели Stable Diffusion.
- 
### 4. **`streamlit_only.py`** (бэкенд + фронтенд)
Объединяет в себе функционал **`server.py`** и **`app.py`** в монолитной архитектуре.

### Установка зависимостей

Для установки всех зависимостей, создайте файл `requirements.txt`, в котором будут перечислены все необходимые библиотеки. Вот пример его содержания:

```txt
fastapi
uvicorn
streamlit
requests
pillow
torch
diffusers
```

Чтобы установить зависимости, выполните команду:

```bash
pip install -r requirements.txt
```

### Запуск проекта

1. Установите все зависимости:

   ```bash
   pip install -r requirements.txt
   ```

2. Запустите сервер FastAPI (`server.py`):
   ```bash
   uvicorn server:app --reload
   ```

3. Запустите приложение Streamlit (`app.py`):
   ```bash
   streamlit run app.py
   ```

4. Перейдите в браузер по адресу `http://localhost:8501`, загрузите изображение и примените перенос стиля.

   
***Альтернативный запуск*** 
1. Запустите приложение Streamlit (`streamlit_only.py`):
   ```bash
   streamlit run streamlit_only.py
   ```
2. Перейдите в браузер по адресу `http://localhost:8501`, загрузите изображение и примените перенос стиля.


### Рекомендации ###
Инференс Stable Diffusion без GPU может требовать длительного времени. Примеры использования записаны в веб-демо, 
удобно открываются во вкладке браузера и плеером.
Так приведен ноутбук, использовавшийся для тренировки Cycle_Can, однако история обучения с метриками приведена только частично.
Из-за объемного вывода  соответственно логам последняя строка в json структуре ноутбука оказалась оборвна.
